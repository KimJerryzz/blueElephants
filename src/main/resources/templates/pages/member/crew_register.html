<!DOCTYPE html>
<html lang="ko" xml:lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <!--
        생성일 21.08.17
        생성자 : 김재일
        단체 회원가입 폼
    -->
    <th:block th:include="fragments/header"></th:block>
    <script>
        let loginId;
        let idDupBool;
        let email;
        let email01;
        let email02;
        let email03;
        let tempKey;
        let idNm;
        let crewDvTy = $("#crewDvTy");

        $(function(){
            fn_chgCrewDvTy('NM_CREW');
        });

        function fn_chgCrewDvTy(gbn){
            if(gbn == "NM_CREW"){
                $('.ggCrew').hide();
                $('.nmCrew').show();
                crewDvTy.val('NM_CREW');
            }else if(gbn == "GG_CREW"){
                $('.ggCrew').show();
                $('.nmCrew').hide();
                crewDvTy.val('GG_CREW');
            }
        }
        /*
        * fn_chkField() input 체크 함수
        * 생성일 : 21.08.17
        * 생성자 : 김재일
        * */
        function fn_chkField() {
            let thumb_file = $('input[id=thumbFile]');
        }

        /*
        * fn_comparePwd() 암호 필드 체크
        * 생성일 : 21.08.17
        * 생성자 : 김재일
        * */
        function fn_comparePwd() {
            pwd = $("#pwd");
            pwdChk = $('#pwdChk');
            pwdChk.siblings('.err.emph').remove();
            if (pwd.val() != pwdChk.val()) {
                pwdChk.after('<p class="err emph">비밀번호가 일치하지 않습니다.</p>');
            }
        }

        /*
        * fn_checkSpacebar() 공백제거
        * 생성일 : 21.08.17
        * 생성자 : 김재일
        * */
        function fn_checkSpacebar() {
            let keyCode = event.keyCode;
            if(keyCode == 32) event.returnValue = false;
        }

        /*
        * fn_chkIdDup() id 중복확인
        * 생성일 : 21.08.17
        * 생성자 : 김재일
        * */
        function fn_chkIdDup(){
            loginId = $("#loginId");
            loginId.siblings('.err.emph').remove();

            if(!loginIdCheck(loginId)){
                return false;
            }

            $.ajax({
                type: "POST",
                url: "/api/member/isExistsByLoginId",
                data: {
                    "loginId": loginId.val()
                },
                success: function (data) {
                    if(loginId.val() != ''){
                        alert('사용가능한 아이디 입니다.');
                        idDupBool = true;
                    }
                },
                error: function (error) {
                    alert(error.responseText);
                    idDupBool = false;
                    loginId.val('');
                    loginId.focus();
                }
            });
        }

        /*
        * fn_niceCallPopup() 휴대폰 인증 팝업
        * 생성일 : 21.08.15
        * 생성자 : 김재일
        * */
        window.name ="Parent_window";
        function fn_niceCallPopup(){
            window.open('/api/nice/call', 'popupNiceCall', 'width=500, height=550, top=100, left=100, fullscreen=no, menubar=no, status=no, toolbar=no, titlebar=yes, location=no, scrollbar=no');
        }

        window.addEventListener('message', function (e) {
            if (e.origin !== "https://nice.checkplus.co.kr") {
                return ;
            }
        });

        /*
        *  fn_chkEmailDup 인증번호 확인 메서드
        *  작성일 : 21.08.15
        *  작성자 : 김재일
        *  이메일 확인 함수
        * */
        function fn_chkEmailDup(g){
            let emailStr = "";
            if(g != null) {
                email = $("#g_email");
                email01 = $("#g_email01");
                email02 = $("#g_email02");
                email03 = $("#g_email03");
                idNm = "g_email";
            } else {
                email = $("#email");
                email01 = $("#email01");
                email02 = $("#email02");
                email03 = $("#email03");
                idNm = "email";
            }

            email.siblings('.err.emph').remove();
            if ($.trim(email01.val())) {
                emailStr += $.trim(email01.val());
                emailStr += "@"
            }else{
                alert('이메일을 입력하세요');
                email01.focus();
                return false;
            }

            if ($.trim(email02.val()) != "직접입력") {
                if(!$.trim(email02.val())){
                    alert('이메일을 입력하세요');
                    email02.focus();
                    return false;
                }else{
                    emailStr += $.trim(email02.val());
                }
            }

            if ($.trim(email02.val()) == "직접입력") {
                if(!$.trim(email03.val())){
                    alert('이메일을 입력하세요');
                    email03.focus();
                    return false;
                }else{
                    emailStr += $.trim(email03.val());
                }
            }

            email.val(emailStr);

            if(email.val()){
                if(!emailCheck(email)){
                    email.val("");
                    email01.focus();
                    emailDupBool = false;
                }
            }
            $.ajax({
                type: "POST",
                url: "/api/member/CheckMail",
                data: {
                    idNm: email.val()
                },
                success: function (data) {
                    if(data > 0){
                        tempKey = data;
                        alert('인증번호를 전송하였습니다.');
                        $('#sendEmailBtn').text('재전송');
                        $('#chkTempKeyBtn').show();
                        $('.eKey').val('');
                        $('.eKey').attr("disabled", false);
                        $('.eKey').focus();
                        emailDupBool = true;
                        email01.attr("disabled", true);
                        email02.attr("disabled", true);
                        email03.attr("disabled", true);
                    } else {
                        alert('이미 사용중인 이메일입니다.');
                        emailDupBool = false;
                        email.val('');
                        email01.val('');
                        email02.val('').trigger("change");
                        email03.val('');
                        email01.focus();
                    }
                },
                error: function (error) {
                    alert(error.responseText);
                    emailDupBool = false;
                    email.val('');
                    email01.val('');
                    email02.val('').trigger("change");
                    email03.val('');
                    email01.focus();
                }
            });
        }

        /*
        *  fn_chkEmailTempKey() 인증번호 확인 메서드
        *  작성일 : 21.08.15
        *  작성자 : 김재일
        *  이메일 전송 및 난수 생성 후 인증키를 비교하여 처리한다.
        * */
        function fn_chkEmailTempKey() {
            if(tempKey == $('.eKey').val()) {
                alert('인증되었습니다.');
                $('.eKey').attr("disabled", true);
                $('#authEmailChk').val(2);
                $('#sendEmailBtn').attr('disabled',true);
                $('#chkTempKeyBtn').attr('disabled',true);
                $('#chkTempKeyBtn').text("인증 완료");
            } else {
                alert('인증번호가 올바르지않습니다.');
                $('.eKey').text('');
                $('.eKey').focus();
            }
        }
    </script>
    <style>
        .file_form label {
            display: inline-block;
            height: 35px;
            margin-left: 0px;
            padding: 0 15px;
            color: #ffffff;
            font-size: 14px;
            font-weight: 500;
            line-height: 34px;
            vertical-align: top;
            text-align: center;
            border: 1px solid #5981ba;
            border-radius: 10px;
            background-color: #5981ba;
            cursor: pointer;
        }
    </style>
</head>

<body oncontextmenu='return false' onselectstart='return false' ondragstart='return false'>
<div id="wrap">
    <th:block th:include="fragments/header_gnb"></th:block>
    <div id="container">
        <th:block th:include="fragments/snb"></th:block>
        <div class="contents">
            <div class="page_top">
                <h3 class="page_tit">단체 회원가입</h3>
                <span>고객님께서 입력하신 정보를 안전하고 정확하게 관리하기 위해 최선을 다하겠습니다.</span>
            </div>
            <div class="page_cont join_form_area">
                <form id="form1" name="form1" method="post" modelAttribute="crewForm" enctype="multipart/form-data" >
                    <input type="hidden" name="crewDvTy" id="crewDvTy" value="NM_CREW"/>
                    <div class="tbl_select">
                        <ul class="tab tab_type02">
                            <li class="btn_line_default btn_pill_registerSelect active"><a href="javascript:fn_chgCrewDvTy('NM_CREW');">일반</a></li>
                            <li class="btn_line_default btn_pill_registerSelect"><a href="javascript:fn_chgCrewDvTy('GG_CREW');">지지크루</a></li>
                        </ul>
                    </div>
                    <div class="sec_write">
                        <h4 class="subtit">기본 정보 입력<span class="aster">*</span></h4>
                        <div class="tbl_write">
                            <div class="tbl_write contour">
                                <ul>
                                    <li>
                                        <div class="th">
                                            <label for="loginId">아이디</label>
                                            <span class="aster">*</span>
                                        </div>
                                        <div class="td">
                                            <input type="text" id="loginId" name="loginId" placeholder="6~12자 영문 소문자, 숫자 사용" onkeydown="fn_checkSpacebar()" />
                                            <button type="button" class="btn btn_lg btn_line_blue btn_pill_10" onclick="return fn_chkIdDup();">중복확인</button>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="th"><label for="pwd">비밀번호</label><span class="aster">*</span></div>
                                        <div class="td">
                                            <input type="password" id="pwd" name="pwd" placeholder="8~16자(특수 문자 포함)" onkeyup="fn_comparePwd()" onkeydown="fn_checkSpacebar()" />
                                        </div>
                                    </li>
                                    <li>
                                        <div class="th"><label for="pwdChk">비밀번호 확인</label><span class="aster">*</span></div>
                                        <div class="td"><input type="password" name="pwdChk" id="pwdChk" placeholder="비밀번호 확인" onkeyup="fn_comparePwd()" onkeydown="fn_checkSpacebar()" /></div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="sec_write nmCrew">
                        <h4 class="subtit">단체회원 정보 입력<span class="aster">*</span></h4>
                        <input type="hidden" id="authBothChk" value="0"/>
                        <div class="tbl_write contour">
                                <ul>
                                    <li>
                                        <div class="th">
                                            <label for="crew_nm">단체명</label>
                                            <span class="aster">*</span>
                                        </div>
                                        <div class="td">
                                            <input type="text" id="crew_nm" name="crew_nm" placeholder="단체명을 입력하세요">
                                        </div>
                                    </li>
                                    <li>
                                        <div class="th">
                                            <label for="contact_nm">담당자명</label>
                                            <span class="aster">*</span>
                                        </div>
                                        <div class="td">
                                            <input type="text" id="contact_nm" name="contact_nm" placeholder="담당자명을 입력하세요">
                                        </div>
                                    </li>
                                    <li>
                                        <div class="th">
                                            <label for="position">직책</label>
                                            <span class="aster">*</span>
                                        </div>
                                        <div class="td">
                                            <input type="text" id="position" name="position" placeholder="직책을 입력하세요">
                                        </div>
                                    </li>
                                    <li>
                                        <div class="th">
                                            <label for="enter_no">사업자등록번호</label>
                                            <span class="aster">*</span>
                                        </div>
                                        <div class="td">
                                            <input type="text" id="enter_no" name="enter_no" placeholder="사업자등록번호를 입력하세요">
                                        </div>
                                    </li>
                                    <li>
                                        <div class="th">첨부파일<span class="aster">*</span></div>
                                        <div class="td">
                                            <div class="file_form">
                                                <div th:if="${fileList != null and !fileList.isEmpty()}">
                                                    <p class="file" th:each="item: ${fileList}">
                                                        <span th:text="${item.sil_re_file_nm}">첨부파일.txt</span>
                                                        <a href="javascript:;" class="btn_del" th:onclick="fn_deleteFile('[[${item.fl_pid}]]', this)">
                                                            <span class="blind">삭제</span>
                                                        </a>
                                                    </p>
                                                </div>
                                                <input type="file" name="attachedFile" id="attachedFile" class="multi" th:accept="${allAccept}" />
                                                <label for="attachedFile">파일찾기</label>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="emailAuth">
                                        <input type="hidden" id="authEmailChk" name="authEmailChk" value="0"/>
                                        <div class="th">이메일 주소<span class="aster">*</span></div>
                                        <div class="td">
                                            <div class="email_form clearfix">
                                                <input type="text" name="email01" id="email01" title="이메일 아이디 입력" oninput="fn_emailValidate(this)" onkeydown="fn_checkSpacebar()" />
                                                <span class="at">@</span>
                                                <div class="select">
                                                    <label for="email02" id="email02_label">선택</label>
                                                    <select name="email02" id="email02">
                                                        <option value="">선택</option>
                                                        <option value="naver.com">naver.com</option>
                                                        <option value="gmail.com">gmail.com</option>
                                                        <option value="hanmail.net">hanmail.net</option>
                                                        <option value="nate.com">nate.com</option>
                                                        <option value="daum.net">daum.net</option>
                                                        <option value="직접입력">직접입력</option>
                                                    </select>
                                                </div>
                                                <input type="text" name="email03" id="email03" class="email_inp" title="이메일주소 직접입력" onkeydown="fn_checkSpacebar()" />
                                            </div>
                                            <button type="button" class="btn btn_lg btn_line_blue btn_pill_10" id="sendEmailBtn" onclick="return fn_chkEmailDup();">이메일인증</button>
                                            <input type="hidden" name="email" id="email"/>
                                            <input class="eKey emph" type="text" name="emailKey" placeholder="인증번호 입력" maxlength="8" disabled>
                                            <button type="button" class="btn btn_lg btn_line_blue btn_pill_10" id="chkTempKeyBtn" onclick="return fn_chkEmailTempKey();">인증번호확인</button>
                                            <p class="tip emph">※ 아이디/패스워드 찾기, 회원가입 인증에 사용됩니다. 정확하게 입력해주세요.</p>
                                        </div>
                                    </li>
                                    <li class="phoneAuth">
                                        <input type="hidden" id="authMobileChk" name="authMobileChk" value="0"/>
                                        <div class="th"><label for="moblphon">휴대전화</label><span class="aster" id="moblphonLabel">*</span></div>
                                        <div class="td">
                                            <input type="text" id="moblphon" name="moblphon" placeholder="'-' 구분없이 입력 ex)01012345678" readonly>
                                            <input type="hidden" id="sRequestNumber" name="sRequestNumber"/>
                                            <input type="hidden" id="sResponseNumber" name="sResponseNumber"/>
                                            <button type="button" class="btn btn_lg btn_line_blue btn_pill_10" onclick="return fn_niceCallPopup();">휴대폰번호인증</button>
                                        </div>
                                    </li>
                                </ul>
                        </div>
                    </div>

                    <div class="sec_write ggCrew">
                        <h4 class="subtit">지지크루 정보 입력<span class="aster">*</span></h4>
                        <div class="tbl_write">
                            <div class="tbl_write contour">
                                <ul>
                                    <li>
                                        <div class="th">
                                            <label for="loginId">지지크루명</label>
                                            <span class="aster">*</span>
                                        </div>
                                        <div class="td">
                                            <input type="text" id="ggCrewNm" name="ggCrewNm" placeholder="지지크루명을 입력하세요." />
                                        </div>
                                    </li>
                                    <li>
                                        <div class="th">
                                            <label for="loginId">소속</label>
                                            <span class="aster">*</span>
                                        </div>
                                        <div class="td">
                                            <input type="text" id="affiNm" name="affiNm" placeholder="소속명을 입력하세요." />
                                        </div>
                                    </li>
                                    <li>
                                        <div class="th">
                                            <label for="loginId">기수</label>
                                            <span class="aster">*</span>
                                        </div>
                                        <div class="td">
                                            <input type="text" id="fNo" name="fNo" placeholder="기수를 입력하세요." />
                                        </div>
                                    </li>
                                    <li>
                                        <div class="th">
                                            <label for="loginId">대표명</label>
                                            <span class="aster">*</span>
                                        </div>
                                        <div class="td">
                                            <input type="text" id="ownerNm" name="ownerNm" placeholder="대표명을 입력하세요." />
                                        </div>
                                    </li>
                                    <li class="emailAuth">
                                        <input type="hidden" id="g_authEmailChk" name="g_authEmailChk" value="0"/>
                                        <div class="th">이메일 주소<span class="aster">*</span></div>
                                        <div class="td">
                                            <div class="email_form clearfix">
                                                <input type="text" name="g_email01" id="g_email01" title="이메일 아이디 입력" oninput="fn_emailValidate(this)" onkeydown="fn_checkSpacebar()" />
                                                <span class="at">@</span>
                                                <div class="select">
                                                    <label for="g_email02" id="g_email02_label">선택</label>
                                                    <select name="g_email02" id="g_email02">
                                                        <option value="">선택</option>
                                                        <option value="naver.com">naver.com</option>
                                                        <option value="gmail.com">gmail.com</option>
                                                        <option value="hanmail.net">hanmail.net</option>
                                                        <option value="nate.com">nate.com</option>
                                                        <option value="daum.net">daum.net</option>
                                                        <option value="직접입력">직접입력</option>
                                                    </select>
                                                </div>
                                                <input type="text" name="gg_email03" id="g_email03" class="email_inp" title="이메일주소 직접입력" onkeydown="fn_checkSpacebar()" />
                                            </div>
                                            <button type="button" class="btn btn_lg btn_line_blue btn_pill_10" id="g_sendEmailBtn" onclick="return fn_chkEmailDup();">이메일인증</button>
                                            <input type="hidden" name="g_email" id="g_email"/>
                                            <input class="eKey emph" type="text" name="g_emailKey" placeholder="인증번호 입력" maxlength="8" disabled>
                                            <button type="button" class="btn btn_lg btn_line_blue btn_pill_10" id="g_chkTempKeyBtn" onclick="return fn_chkEmailTempKey();">인증번호확인</button>
                                            <p class="tip emph">※ 아이디/패스워드 찾기, 회원가입 인증에 사용됩니다. 정확하게 입력해주세요.</p>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="btn_area"><button id="btnSave" class="btn btn_lg btn_blue btn_pill_10">단체 등록</button></div>
                </form>
            </div>
        </div>
    </div>
    <th:block th:replace="fragments/footer"></th:block>
</div>
</body>
</html>
